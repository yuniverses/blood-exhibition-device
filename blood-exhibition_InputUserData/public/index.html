<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Exhibition API ç›£æ§ä¸­å¿ƒ - é–‹ç™¼è€…æ–‡æª”</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css"
    />
    <style>
      :root {
        --primary: #6b7280;
        --success: #10b981;
        --error: #ef4444;
        --warning: #f59e0b;
        --bg: #000000;
        --bg-secondary: #1a1a1a;
        --text: #f3f4f6;
        --text-secondary: #9ca3af;
        --border: #374151;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        background: var(--bg);
        color: var(--text);
        line-height: 1.6;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
      }

      header {
        background: var(--bg-secondary);
        border-bottom: 1px solid var(--border);
        padding: 30px 0;
        margin-bottom: 30px;
      }

      h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
        color: var(--text);
        font-weight: 700;
      }

      .subtitle {
        color: var(--text-secondary);
        font-size: 1.1rem;
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .card {
        background: var(--bg-secondary);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 20px;
        transition: transform 0.2s, box-shadow 0.2s;
      }

      .card:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 30px rgba(255, 255, 255, 0.05);
      }

      .card h2 {
        font-size: 1.3rem;
        margin-bottom: 15px;
        color: var(--text);
      }

      .status-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 15px;
        margin-bottom: 30px;
      }

      .status-item {
        background: var(--bg-secondary);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 15px;
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .status-indicator {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        flex-shrink: 0;
        animation: pulse 2s infinite;
      }

      .status-indicator.success {
        background: var(--success);
        box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2);
      }

      .status-indicator.error {
        background: var(--error);
        box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.2);
      }

      .status-indicator.loading {
        background: var(--warning);
        box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.2);
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.7;
        }
      }

      .method-badge {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        margin-right: 8px;
      }

      .method-get {
        background: #10b981;
      }
      .method-post {
        background: #3b82f6;
      }
      .method-put {
        background: #f59e0b;
      }
      .method-patch {
        background: #8b5cf6;
      }
      .method-delete {
        background: #ef4444;
      }

      .json-viewer {
        background: #1a1a1a;
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 20px;
        overflow-x: auto;
        font-family: "Monaco", "Courier New", monospace;
        font-size: 0.9rem;
        line-height: 1.5;
      }

      pre {
        margin: 0;
        white-space: pre-wrap;
        word-wrap: break-word;
      }

      .tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        border-bottom: 1px solid var(--border);
      }

      .tab {
        padding: 10px 20px;
        background: none;
        border: none;
        color: var(--text-secondary);
        cursor: pointer;
        font-size: 1rem;
        transition: color 0.2s, border-color 0.2s;
        border-bottom: 2px solid transparent;
        margin-bottom: -1px;
      }

      .tab.active {
        color: var(--text);
        border-bottom-color: var(--text);
      }

      .tab:hover {
        color: var(--text);
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .code-example {
        background: var(--bg-secondary);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 15px;
        margin: 15px 0;
      }

      .copy-btn {
        background: var(--border);
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.85rem;
        transition: background 0.2s;
        float: right;
        margin-top: -5px;
      }

      .copy-btn:hover {
        background: #4b5563;
      }

      .copy-btn.copied {
        background: var(--success);
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin: 20px 0;
      }

      .stat-item {
        background: var(--bg-secondary);
        padding: 20px;
        border-radius: 8px;
        border: 1px solid var(--border);
      }

      .stat-value {
        font-size: 2rem;
        font-weight: bold;
        color: var(--text);
      }

      .stat-label {
        color: var(--text-secondary);
        font-size: 0.9rem;
        margin-top: 5px;
      }

      .refresh-btn {
        background: var(--border);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        transition: background 0.2s;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .refresh-btn:hover {
        background: #4b5563;
      }

      .refresh-btn:disabled {
        background: var(--border);
        cursor: not-allowed;
      }

      @media (max-width: 768px) {
        h1 {
          font-size: 1.8rem;
        }
        .grid {
          grid-template-columns: 1fr;
        }
        .status-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <div class="container">
        <h1>Exhibition API ç›£æ§ä¸­å¿ƒ</h1>
        <p class="subtitle">æœ¬åœ°ç«¯å±•è¦½è³‡æ–™åº« API - é–‹ç™¼è€…æ–‡æª”èˆ‡ç³»çµ±ç‹€æ…‹</p>
      </div>
    </header>

    <div class="container">
      <!-- ç³»çµ±ç‹€æ…‹æ¦‚è¦½ -->
      <div class="card">
        <h2>ğŸ” ç³»çµ±ç‹€æ…‹æ¦‚è¦½</h2>
        <div class="stats-grid" id="statsGrid">
          <div class="stat-item">
            <div class="stat-value" id="totalUsers">-</div>
            <div class="stat-label">ç¸½ç”¨æˆ¶æ•¸</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="totalInteractions">-</div>
            <div class="stat-label">ç¸½äº’å‹•æ¬¡æ•¸</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="avgInteractions">-</div>
            <div class="stat-label">å¹³å‡äº’å‹•æ¬¡æ•¸</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="apiStatus">-</div>
            <div class="stat-label">API ç‹€æ…‹</div>
          </div>
        </div>
        <button class="refresh-btn" onclick="refreshAll()">
          <span>ğŸ”„</span> é‡æ–°æ•´ç†ç‹€æ…‹
        </button>
      </div>

      <!-- API ç«¯é»ç‹€æ…‹ -->
      <div class="card">
        <h2>ğŸ“¡ API ç«¯é»ç‹€æ…‹</h2>
        <div class="status-grid" id="apiStatusGrid">
          <!-- å‹•æ…‹ç”Ÿæˆ -->
        </div>
      </div>

      <!-- è³‡æ–™çµæ§‹ -->
      <div class="card">
        <h2>ğŸ“Š è³‡æ–™çµæ§‹</h2>
        <div class="tabs">
          <button class="tab active" onclick="switchTab('schema')">
            Schema çµæ§‹
          </button>
          <button class="tab" onclick="switchTab('sample')">ç¯„ä¾‹è³‡æ–™</button>
          <button class="tab" onclick="switchTab('current')">ç›®å‰è³‡æ–™</button>
        </div>

        <div class="tab-content active" id="schema-tab">
          <div class="json-viewer">
            <pre><code class="language-json" id="schemaDisplay">{
  "uuid": "string (UUID v4) - å”¯ä¸€è­˜åˆ¥ç¢¼",
  "bloodType": "string - è¡€å‹ (A/B/AB/O with +/-)",
  "username": "string - ä½¿ç”¨è€…åç¨±",
  "entryTime": "ISO 8601 - å…¥å ´æ™‚é–“",
  "interactions": [
    {
      "deviceId": "string - è£ç½®ID",
      "deviceName": "string - è£ç½®åç¨±",
      "actionType": "string - å‹•ä½œé¡å‹",
      "data": "object - è‡ªè¨‚è³‡æ–™",
      "timestamp": "ISO 8601 - äº’å‹•æ™‚é–“"
    }
  ],
  "lastUpdated": "ISO 8601 - æœ€å¾Œæ›´æ–°æ™‚é–“",
  "...": "æ”¯æ´å‹•æ…‹æ“´å……ä»»æ„æ¬„ä½"
}</code></pre>
          </div>
        </div>

        <div class="tab-content" id="sample-tab">
          <div class="json-viewer">
            <pre><code class="language-json" id="sampleData">{
  "uuid": "550e8400-e29b-41d4-a716-446655440000",
  "bloodType": "A+",
  "username": "å¼µå°æ˜",
  "entryTime": "2024-01-01T10:00:00.000Z",
  "interactions": [
    {
      "deviceId": "DEVICE001",
      "deviceName": "äº’å‹•è¢å¹• A",
      "actionType": "scan",
      "data": {
        "content": "è§€çœ‹å±•è¦½ä»‹ç´¹",
        "duration": 120
      },
      "timestamp": "2024-01-01T10:15:00.000Z"
    }
  ],
  "department": "å·¥ç¨‹éƒ¨",
  "customField": "è‡ªè¨‚è³‡æ–™"
}</code></pre>
          </div>
        </div>

        <div class="tab-content" id="current-tab">
          <div class="json-viewer">
            <pre><code class="language-json" id="currentData">è¼‰å…¥ä¸­...</code></pre>
          </div>
        </div>
      </div>

      <!-- API ä½¿ç”¨æ–‡æª” -->
      <div class="card">
        <h2>ğŸ“– API ä½¿ç”¨æ–‡æª”</h2>
        <div class="tabs">
          <button class="tab active" onclick="switchDocTab('javascript')">
            JavaScript
          </button>
          <button class="tab" onclick="switchDocTab('python')">Python</button>
          <button class="tab" onclick="switchDocTab('curl')">cURL</button>
          <button class="tab" onclick="switchDocTab('qrcode')">
            QR Code æ•´åˆ
          </button>
        </div>

        <div class="tab-content active" id="javascript-doc">
          <h3>JavaScript / Node.js ç¯„ä¾‹</h3>

          <div class="code-example">
            <button class="copy-btn" onclick="copyCode('js-create')">
              è¤‡è£½
            </button>
            <pre><code class="language-javascript" id="js-create">// æ–°å¢ç”¨æˆ¶
const createUser = async () => {
    const response = await fetch('http://localhost:3000/api/users', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            bloodType: 'A+',
            username: 'æ¸¬è©¦ç”¨æˆ¶',
            department: 'ç ”ç™¼éƒ¨'
        })
    });
    const data = await response.json();
    console.log('æ–°ç”¨æˆ¶ UUID:', data.data.uuid);
    return data.data;
};</code></pre>
          </div>

          <div class="code-example">
            <button class="copy-btn" onclick="copyCode('js-interact')">
              è¤‡è£½
            </button>
            <pre><code class="language-javascript" id="js-interact">// è¨˜éŒ„äº’å‹•äº‹ä»¶
const addInteraction = async (uuid, deviceId) => {
    const response = await fetch(`http://localhost:3000/api/users/${uuid}/interactions`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            deviceId: deviceId,
            deviceName: 'äº’å‹•è£ç½® A',
            actionType: 'scan',
            data: {
                content: 'QR Code æƒæ',
                location: 'å±•å€ 1'
            }
        })
    });
    return await response.json();
};</code></pre>
          </div>

          <div class="code-example">
            <button class="copy-btn" onclick="copyCode('js-query')">
              è¤‡è£½
            </button>
            <pre><code class="language-javascript" id="js-query">// æŸ¥è©¢ç”¨æˆ¶è³‡æ–™
const getUserData = async (uuid) => {
    const response = await fetch(`http://localhost:3000/api/users/${uuid}`);
    const data = await response.json();
    
    if (data.success) {
        console.log('ç”¨æˆ¶åç¨±:', data.data.username);
        console.log('è¡€å‹:', data.data.bloodType);
        console.log('äº’å‹•æ¬¡æ•¸:', data.data.interactions.length);
    }
    return data.data;
};</code></pre>
          </div>
        </div>

        <div class="tab-content" id="python-doc">
          <h3>Python ç¯„ä¾‹</h3>

          <div class="code-example">
            <button class="copy-btn" onclick="copyCode('py-create')">
              è¤‡è£½
            </button>
            <pre><code class="language-python" id="py-create">import requests
import json

# æ–°å¢ç”¨æˆ¶
def create_user(blood_type, username):
    url = 'http://localhost:3000/api/users'
    data = {
        'bloodType': blood_type,
        'username': username
    }
    
    response = requests.post(url, json=data)
    result = response.json()
    
    if result['success']:
        uuid = result['data']['uuid']
        print(f'æ–°ç”¨æˆ¶ UUID: {uuid}')
        return uuid
    return None

# ä½¿ç”¨ç¯„ä¾‹
uuid = create_user('A+', 'æ¸¬è©¦ç”¨æˆ¶')</code></pre>
          </div>

          <div class="code-example">
            <button class="copy-btn" onclick="copyCode('py-interact')">
              è¤‡è£½
            </button>
            <pre><code class="language-python" id="py-interact"># è¨˜éŒ„äº’å‹•
def add_interaction(uuid, device_id, action_type):
    url = f'http://localhost:3000/api/users/{uuid}/interactions'
    data = {
        'deviceId': device_id,
        'deviceName': 'äº’å‹•è£ç½®',
        'actionType': action_type,
        'data': {
            'timestamp': datetime.now().isoformat()
        }
    }
    
    response = requests.post(url, json=data)
    return response.json()</code></pre>
          </div>
        </div>

        <div class="tab-content" id="curl-doc">
          <h3>cURL å‘½ä»¤ç¯„ä¾‹</h3>

          <div class="code-example">
            <button class="copy-btn" onclick="copyCode('curl-create')">
              è¤‡è£½
            </button>
            <pre><code class="language-bash" id="curl-create"># æ–°å¢ç”¨æˆ¶
curl -X POST http://localhost:3000/api/users \
  -H "Content-Type: application/json" \
  -d '{
    "bloodType": "A+",
    "username": "æ¸¬è©¦ç”¨æˆ¶",
    "department": "ç ”ç™¼éƒ¨"
  }'</code></pre>
          </div>

          <div class="code-example">
            <button class="copy-btn" onclick="copyCode('curl-get')">
              è¤‡è£½
            </button>
            <pre><code class="language-bash" id="curl-get"># æŸ¥è©¢ç”¨æˆ¶
curl http://localhost:3000/api/users/[UUID]

# æŸ¥è©¢æ‰€æœ‰ç”¨æˆ¶
curl http://localhost:3000/api/users

# ä¾è¡€å‹æœå°‹
curl http://localhost:3000/api/users/search/bloodType/A+</code></pre>
          </div>
        </div>

        <div class="tab-content" id="qrcode-doc">
          <h3>QR Code æ•´åˆæ–¹æ¡ˆ</h3>

          <div class="code-example">
            <button class="copy-btn" onclick="copyCode('qr-flow')">è¤‡è£½</button>
            <pre><code class="language-javascript" id="qr-flow">// QR Code æƒæè™•ç†æµç¨‹
class QRCodeHandler {
    constructor(apiBase = 'http://localhost:3000/api') {
        this.apiBase = apiBase;
    }
    
    // 1. ç”¨æˆ¶è¨»å†Šæ™‚ç”Ÿæˆ QR Code
    async registerUser(bloodType, username) {
        const response = await fetch(`${this.apiBase}/users`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ bloodType, username })
        });
        
        const data = await response.json();
        const uuid = data.data.uuid;
        
        // ç”Ÿæˆ QR Code å…§å®¹
        const qrContent = {
            type: 'EXHIBITION_USER',
            uuid: uuid,
            bloodType: bloodType
        };
        
        return JSON.stringify(qrContent);
    }
    
    // 2. è£ç½®æƒæ QR Code å¾Œçš„è™•ç†
    async handleQRScan(qrContent, deviceId) {
        const qrData = JSON.parse(qrContent);
        
        // è¨˜éŒ„äº’å‹•
        await fetch(`${this.apiBase}/users/${qrData.uuid}/interactions`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                deviceId: deviceId,
                deviceName: `è£ç½® ${deviceId}`,
                actionType: 'qr_scan',
                data: {
                    scanTime: new Date().toISOString(),
                    deviceLocation: 'Exhibition Hall A'
                }
            })
        });
        
        // å–å¾—ç”¨æˆ¶è³‡æ–™
        const userResponse = await fetch(`${this.apiBase}/users/${qrData.uuid}`);
        const userData = await userResponse.json();
        
        return userData.data;
    }
    
    // 3. å±•è¦½çµæŸæ™‚å½™æ•´è³‡æ–™
    async getUserSummary(uuid) {
        const response = await fetch(`${this.apiBase}/users/${uuid}`);
        const data = await response.json();
        
        const user = data.data;
        const summary = {
            username: user.username,
            bloodType: user.bloodType,
            totalInteractions: user.interactions.length,
            visitedDevices: [...new Set(user.interactions.map(i => i.deviceId))],
            timeSpent: this.calculateTimeSpent(user.interactions),
            journey: user.interactions.map(i => ({
                device: i.deviceName,
                time: i.timestamp,
                action: i.actionType
            }))
        };
        
        return summary;
    }
    
    calculateTimeSpent(interactions) {
        if (interactions.length === 0) return 0;
        const times = interactions.map(i => new Date(i.timestamp));
        const first = Math.min(...times);
        const last = Math.max(...times);
        return Math.round((last - first) / 60000); // åˆ†é˜
    }
}</code></pre>
          </div>

          <div class="code-example">
            <h4>QR Code å…§å®¹æ ¼å¼å»ºè­°</h4>
            <pre><code class="language-json">{
  "type": "EXHIBITION_USER",
  "uuid": "550e8400-e29b-41d4-a716-446655440000",
  "bloodType": "A+",
  "version": "1.0"
}</code></pre>
          </div>
        </div>
      </div>

      <!-- AI æ•´åˆ Prompt -->
      <div class="card">
        <h2>ğŸ¤– AI æ•´åˆ Prompt (å¯ç·¨è¼¯ä¸¦è¤‡è£½)</h2>
        <div style="margin-bottom: 15px">
          <button
            class="copy-btn"
            onclick="copyPrompt()"
            style="float: none; margin-right: 10px"
          >
            è¤‡è£½ Prompt
          </button>
          <button
            class="refresh-btn"
            onclick="loadLatestUserData()"
            style="padding: 6px 12px; font-size: 0.85rem"
          >
            è¼‰å…¥æœ€æ–°ç”¨æˆ¶è³‡æ–™
          </button>
        </div>
        <textarea
          id="ai-prompt-textarea"
          style="
            width: 100%;
            min-height: 600px;
            background: var(--bg-secondary);
            color: var(--text);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            font-family: system-ui, -apple-system, sans-serif;
            font-size: 0.95rem;
            line-height: 1.6;
            resize: vertical;
          "
        >
æˆ‘éœ€è¦é€£æ¥åˆ°ä¸€å€‹å…§ç¶²çš„å±•è¦½è¿½è¹¤ç³»çµ± APIã€‚

ç³»çµ±è³‡è¨Šï¼š
- API ä½å€ï¼šhttp://localhost:3000/api (è«‹æ›¿æ›æˆå¯¦éš› IP)
- è³‡æ–™æ ¼å¼ï¼šJSON
- ç„¡éœ€èªè­‰
- ä¸»è¦ç”¨é€”ï¼šè¨˜éŒ„å±•è¦½åƒè§€è€…çš„è¡€å‹ã€å§“åã€å…¥å ´æ™‚é–“å’Œäº’å‹•è¨˜éŒ„

è³‡æ–™çµæ§‹ï¼š
ç”¨æˆ¶ç‰©ä»¶åŒ…å« uuid (è‡ªå‹•ç”Ÿæˆ)ã€bloodType (A+/A-/B+/B-/AB+/AB-/O+/O-)ã€usernameã€entryTime (è‡ªå‹•è¨˜éŒ„)ã€interactions é™£åˆ—ã€å¯è‡ªè¨‚æ“´å……æ¬„ä½

å¯¦éš›ç”¨æˆ¶è³‡æ–™ç¯„ä¾‹ï¼š
{
  "uuid": "550e8400-e29b-41d4-a716-446655440000",
  "bloodType": "A+",
  "username": "å¼µå°æ˜",
  "entryTime": "2024-01-01T10:00:00.000Z",
  "interactions": [
    {
      "deviceId": "DEVICE001",
      "deviceName": "äº’å‹•è¢å¹• A",
      "actionType": "scan",
      "data": {
        "content": "è§€çœ‹å±•è¦½ä»‹ç´¹",
        "duration": 120
      },
      "timestamp": "2024-01-01T10:15:00.000Z"
    }
  ],
  "department": "å·¥ç¨‹éƒ¨",
  "customField": "è‡ªè¨‚è³‡æ–™",
  "lastUpdated": "2024-01-01T10:15:00.000Z"
}

API ç«¯é»ï¼š
GET /api/users - å–å¾—æ‰€æœ‰ç”¨æˆ¶
GET /api/users/{uuid} - å–å¾—ç‰¹å®šç”¨æˆ¶
POST /api/users - æ–°å¢ç”¨æˆ¶ (éœ€è¦ bloodType å’Œ username)
PUT /api/users/{uuid} - æ›´æ–°ç”¨æˆ¶è³‡æ–™
POST /api/users/{uuid}/interactions - æ–°å¢äº’å‹•è¨˜éŒ„ (éœ€è¦ deviceIdã€deviceNameã€actionType)
DELETE /api/users/{uuid} - åˆªé™¤ç”¨æˆ¶
GET /api/users/search/{field}/{value} - æœå°‹ç”¨æˆ¶ (ä¾‹å¦‚ï¼š/search/bloodType/A+)
POST /api/users/batch - æ‰¹æ¬¡æ–°å¢ç”¨æˆ¶ (é™£åˆ—æ ¼å¼)
GET /api/statistics - å–å¾—çµ±è¨ˆè³‡è¨Š

äº’å‹•è¨˜éŒ„æ ¼å¼ï¼š
{ 
  "deviceId": "è¨­å‚™ç·¨è™Ÿ", 
  "deviceName": "è¨­å‚™åç¨±", 
  "actionType": "å‹•ä½œé¡å‹", 
  "data": {è‡ªè¨‚è³‡æ–™}, 
  "timestamp": "è‡ªå‹•ç”Ÿæˆ" 
}

æˆåŠŸå›æ‡‰æ ¼å¼ï¼š{ "success": true, "data": {...} }
éŒ¯èª¤å›æ‡‰æ ¼å¼ï¼š{ "success": false, "error": "éŒ¯èª¤è¨Šæ¯" }

éŒ¯èª¤ç¢¼èªªæ˜ï¼š
- 400: è«‹æ±‚éŒ¯èª¤ï¼ˆé©—è­‰å¤±æ•—ï¼‰
- 404: è³‡æºä¸å­˜åœ¨
- 500: ä¼ºæœå™¨å…§éƒ¨éŒ¯èª¤

è«‹å¹«æˆ‘å¯«ä¸€å€‹å®¢æˆ¶ç«¯ç¨‹å¼ï¼ŒåŒ…å«ï¼š
</textarea
        >
      </div>

      <!-- éŒ¯èª¤è™•ç†èªªæ˜ -->
      <div class="card">
        <h2>âš ï¸ éŒ¯èª¤è™•ç†</h2>
        <div class="code-example">
          <pre><code class="language-javascript">// éŒ¯èª¤è™•ç†ç¯„ä¾‹
const apiCall = async (url, options = {}) => {
    try {
        const response = await fetch(url, options);
        const data = await response.json();
        
        if (!data.success) {
            console.error('API éŒ¯èª¤:', data.error);
            // è™•ç†ç‰¹å®šéŒ¯èª¤
            switch(response.status) {
                case 400:
                    console.log('è«‹æ±‚åƒæ•¸éŒ¯èª¤');
                    break;
                case 404:
                    console.log('è³‡æºä¸å­˜åœ¨');
                    break;
                case 500:
                    console.log('ä¼ºæœå™¨éŒ¯èª¤');
                    break;
            }
        }
        
        return data;
    } catch (error) {
        console.error('ç¶²è·¯éŒ¯èª¤:', error);
        return null;
    }
};</code></pre>
        </div>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>

    <script>
      const API_BASE = "http://localhost:3000/api";

      // API ç«¯é»åˆ—è¡¨
      const endpoints = [
        { method: "GET", path: "/health", name: "å¥åº·æª¢æŸ¥" },
        { method: "GET", path: "/users", name: "å–å¾—æ‰€æœ‰ç”¨æˆ¶" },
        { method: "POST", path: "/users", name: "æ–°å¢ç”¨æˆ¶" },
        { method: "GET", path: "/users/:uuid", name: "æŸ¥è©¢ç”¨æˆ¶" },
        { method: "PUT", path: "/users/:uuid", name: "æ›´æ–°ç”¨æˆ¶" },
        { method: "POST", path: "/users/:uuid/interactions", name: "æ–°å¢äº’å‹•" },
        { method: "DELETE", path: "/users/:uuid", name: "åˆªé™¤ç”¨æˆ¶" },
        { method: "POST", path: "/users/batch", name: "æ‰¹æ¬¡æ–°å¢" },
        { method: "GET", path: "/statistics", name: "çµ±è¨ˆè³‡è¨Š" },
      ];

      // æª¢æŸ¥ API ç‹€æ…‹
      async function checkAPIStatus() {
        const grid = document.getElementById("apiStatusGrid");
        grid.innerHTML = "";

        for (const endpoint of endpoints) {
          const div = document.createElement("div");
          div.className = "status-item";

          let status = "loading";
          let statusText = "æª¢æ¸¬ä¸­...";

          try {
            if (
              endpoint.path === "/health" ||
              (endpoint.method === "GET" && !endpoint.path.includes(":uuid"))
            ) {
              const response = await fetch(API_BASE + endpoint.path);
              if (response.ok) {
                status = "success";
                statusText = "æ­£å¸¸";
              } else {
                status = "error";
                statusText = "ç•°å¸¸";
              }
            } else {
              // å°æ–¼éœ€è¦åƒæ•¸çš„ç«¯é»ï¼Œåªæª¢æŸ¥å¥åº·ç‹€æ…‹
              const healthCheck = await fetch(API_BASE + "/health");
              if (healthCheck.ok) {
                status = "success";
                statusText = "å°±ç·’";
              } else {
                status = "error";
                statusText = "é›¢ç·š";
              }
            }
          } catch (error) {
            status = "error";
            statusText = "ç„¡æ³•é€£ç·š";
          }

          div.innerHTML = `
                    <div class="status-indicator ${status}"></div>
                    <div style="flex: 1;">
                        <div>
                            <span class="method-badge method-${endpoint.method.toLowerCase()}">${
            endpoint.method
          }</span>
                            ${endpoint.name}
                        </div>
                        <div style="color: var(--text-secondary); font-size: 0.85rem; margin-top: 4px;">
                            ${endpoint.path} - ${statusText}
                        </div>
                    </div>
                `;

          grid.appendChild(div);
        }
      }

      // è¼‰å…¥çµ±è¨ˆè³‡æ–™
      async function loadStatistics() {
        try {
          const response = await fetch(API_BASE + "/statistics");
          const data = await response.json();

          if (data.success) {
            const stats = data.data;
            document.getElementById("totalUsers").textContent =
              stats.totalUsers || "0";
            document.getElementById("totalInteractions").textContent =
              stats.totalInteractions || "0";
            document.getElementById("avgInteractions").textContent = (
              stats.averageInteractionsPerUser || 0
            ).toFixed(1);
            document.getElementById("apiStatus").textContent = "é‹è¡Œä¸­";
            document.getElementById("apiStatus").style.color = "var(--success)";
          }
        } catch (error) {
          document.getElementById("apiStatus").textContent = "é›¢ç·š";
          document.getElementById("apiStatus").style.color = "var(--error)";
        }
      }

      // è¼‰å…¥ç›®å‰è³‡æ–™
      async function loadCurrentData() {
        try {
          const response = await fetch(API_BASE + "/users");
          const data = await response.json();

          if (data.success) {
            const formatted = JSON.stringify(data.data, null, 2);
            document.getElementById("currentData").textContent = formatted;
            Prism.highlightElement(document.getElementById("currentData"));
          }
        } catch (error) {
          document.getElementById("currentData").textContent = "ç„¡æ³•è¼‰å…¥è³‡æ–™";
        }
      }

      // åˆ‡æ›æ¨™ç±¤
      function switchTab(tabName) {
        // ç§»é™¤æ‰€æœ‰ active
        document
          .querySelectorAll(".tab")
          .forEach((tab) => tab.classList.remove("active"));
        document
          .querySelectorAll(".tab-content")
          .forEach((content) => content.classList.remove("active"));

        // è¨­å®š active
        event.target.classList.add("active");
        document.getElementById(`${tabName}-tab`).classList.add("active");

        // å¦‚æœæ˜¯ç›®å‰è³‡æ–™æ¨™ç±¤ï¼Œè¼‰å…¥è³‡æ–™
        if (tabName === "current") {
          loadCurrentData();
        }
      }

      // åˆ‡æ›æ–‡æª”æ¨™ç±¤
      function switchDocTab(tabName) {
        // ç§»é™¤æ‰€æœ‰ active
        event.target.parentElement
          .querySelectorAll(".tab")
          .forEach((tab) => tab.classList.remove("active"));
        event.target.parentElement.parentElement
          .querySelectorAll(".tab-content")
          .forEach((content) => content.classList.remove("active"));

        // è¨­å®š active
        event.target.classList.add("active");
        document.getElementById(`${tabName}-doc`).classList.add("active");
      }

      // è¤‡è£½ç¨‹å¼ç¢¼
      function copyCode(codeId) {
        const code = document.getElementById(codeId).textContent;
        navigator.clipboard.writeText(code).then(() => {
          const btn = event.target;
          btn.textContent = "å·²è¤‡è£½!";
          btn.classList.add("copied");
          setTimeout(() => {
            btn.textContent = "è¤‡è£½";
            btn.classList.remove("copied");
          }, 2000);
        });
      }

      // è¤‡è£½ AI Prompt
      function copyPrompt() {
        const promptText = document.getElementById("ai-prompt-textarea").value;
        navigator.clipboard.writeText(promptText).then(() => {
          const btn = event.target;
          const originalText = btn.textContent;
          btn.textContent = "å·²è¤‡è£½!";
          btn.style.background = "var(--success)";
          setTimeout(() => {
            btn.textContent = originalText;
            btn.style.background = "";
          }, 2000);
        });
      }

      // è¼‰å…¥æœ€æ–°ç”¨æˆ¶è³‡æ–™åˆ° Prompt
      async function loadLatestUserData() {
        try {
          const response = await fetch(API_BASE + "/users");
          const data = await response.json();

          if (data.success && data.data.length > 0) {
            // å–å¾—æœ€æ–°çš„ç”¨æˆ¶è³‡æ–™
            const latestUser = data.data[data.data.length - 1];

            // å–å¾—ç¾æœ‰çš„ textarea å…§å®¹
            const textarea = document.getElementById("ai-prompt-textarea");
            const currentContent = textarea.value;

            // æ‰¾åˆ°å¯¦éš›ç”¨æˆ¶è³‡æ–™ç¯„ä¾‹çš„ä½ç½®ä¸¦æ›¿æ›
            const startMarker = "å¯¦éš›ç”¨æˆ¶è³‡æ–™ç¯„ä¾‹ï¼š";
            const endMarker = "\n\nAPI ç«¯é»ï¼š";

            const startIndex = currentContent.indexOf(startMarker);
            const endIndex = currentContent.indexOf(endMarker);

            if (startIndex !== -1 && endIndex !== -1) {
              const newUserExample =
                startMarker + "\n" + JSON.stringify(latestUser, null, 2);
              const newContent =
                currentContent.substring(0, startIndex) +
                newUserExample +
                currentContent.substring(endIndex);
              textarea.value = newContent;

              // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
              const btn = event.target;
              const originalText = btn.textContent;
              btn.textContent = "å·²è¼‰å…¥æœ€æ–°è³‡æ–™!";
              btn.style.background = "var(--success)";
              setTimeout(() => {
                btn.textContent = originalText;
                btn.style.background = "";
              }, 2000);
            }
          } else {
            alert("ç›®å‰æ²’æœ‰ç”¨æˆ¶è³‡æ–™");
          }
        } catch (error) {
          console.error("è¼‰å…¥è³‡æ–™å¤±æ•—:", error);
          alert("è¼‰å…¥è³‡æ–™å¤±æ•—");
        }
      }

      // é‡æ–°æ•´ç†æ‰€æœ‰
      async function refreshAll() {
        const btn = event.target;
        btn.disabled = true;

        await Promise.all([
          checkAPIStatus(),
          loadStatistics(),
          loadCurrentData(),
        ]);

        btn.disabled = false;
      }

      // åˆå§‹è¼‰å…¥
      window.addEventListener("DOMContentLoaded", () => {
        checkAPIStatus();
        loadStatistics();

        // æ¯ 10 ç§’è‡ªå‹•æ›´æ–°
        setInterval(() => {
          checkAPIStatus();
          loadStatistics();
        }, 10000);
      });
    </script>
  </body>
</html>
